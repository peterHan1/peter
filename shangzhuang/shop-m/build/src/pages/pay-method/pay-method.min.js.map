{"version":3,"sources":["webpack:///src/pages/pay-method/pay-method.min.js","webpack:///webpack/bootstrap c3339b398b9f7bca45f3","webpack:///./src/pages/pay-method/pay-method.js","webpack:///./src/components/countly/countly.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","id","loaded","call","m","c","p","Countly","wxpayInterFace","json","onBridgeReady","WeixinJSBridge","invoke","appId","data","timeStamp","nonceStr","package","signType","paySign","res","payResultForm","$","err_msg","attr","val","clickEvent","submit","document","addEventListener","attachEvent","Zepto","canPay","find","click","self","this","orderNum","ajax","url","type","dataType","payMode","orderNumber","success","addClass","isSuccess","window","location","error","setCookie","name","value","options","cookieValue","cookie","cookies","split","i","length","trim","substring","decodeURIComponent","expires","toUTCString","date","Date","setTime","getTime","path","domain","secure","encodeURIComponent","join","className","desc","userInfo","userId","shopId","pageUrl","JSON","parse","href","toString","e","q","push","key","segmentation"],"mappings":"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","file":"src/pages/pay-method/pay-method.min.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\tvar Countly = __webpack_require__(1);\n\t\n\tvar wxpayInterFace = function (json) {\n\t  var onBridgeReady = function () {\n\t    WeixinJSBridge.invoke('getBrandWCPayRequest', {\n\t      'appId': json.data.appId,\n\t      'timeStamp': json.data.timeStamp,\n\t      'nonceStr': json.data.nonceStr,\n\t      'package': json.data.package,\n\t      'signType': 'MD5',\n\t      'paySign': json.data.paySign\n\t    }, function (res) {\n\t      var payResultForm = $('.j_WXPayResult');\n\t      if (res.err_msg === 'get_brand_wcpay_request:ok') {\n\t        payResultForm.attr('action', '/trade/paysuccess?orderNumber=' + $('.j_OrderNumber').val());\n\t        Countly.clickEvent('paySucceedAction');\n\t      } else {\n\t        payResultForm.attr('action', '/trade/payfailure');\n\t      }\n\t      payResultForm.submit();\n\t    });\n\t  };\n\t\n\t  if (typeof WeixinJSBridge === 'undefined') {\n\t    if (document.addEventListener) {\n\t      document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);\n\t    } else if (document.attachEvent) {\n\t      document.attachEvent('WeixinJSBridgeReady', onBridgeReady);\n\t      document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);\n\t    }\n\t  } else {\n\t    onBridgeReady();\n\t  }\n\t};\n\t\n\tZepto(function ($) {\n\t  //var location = window.location.href;\n\t  var canPay = true;\n\t  $('.j_WxBtn').find('input[name=\"express\"]').attr('checked', 'checked');\n\t\n\t  // 点击确认支付\n\t  $('.j_PaySubmit').click(function () {\n\t    var self = $(this);\n\t    if(!canPay) return;\n\t    canPay = false;\n\t    var orderNum = $('.j_OrderNumber').val();\n\t    $.ajax({\n\t      url: '/trade/itemorder/payOrderForWx',\n\t      type: 'POST',\n\t      dataType: 'json',\n\t      data: {\n\t        payMode: 10,\n\t        orderNumber: orderNum\n\t      },\n\t      success: function (json) {\n\t        self.addClass('disable');\n\t        if (json.isSuccess === 1) {\n\t          wxpayInterFace(json);\n\t        } else {\n\t          window.location = $('.j_WebTest').val();\n\t        }\n\t      },\n\t      error: function () { \n\t        canPay = true;\n\t      }\n\t    });\n\t  });\n\t});\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\t\n\tfunction setCookie(name, value, options) {\n\t  if (typeof value != 'undefined') { // name and value given, set cookie\n\t    options = options || {};\n\t    if (value === null) {\n\t      value = '';\n\t      options.expires = -1;\n\t    }\n\t    var expires = '';\n\t    if (options.expires && (typeof options.expires == 'number' || options.expires.toUTCString)) {\n\t      var date;\n\t      if (typeof options.expires == 'number') {\n\t          date = new Date();\n\t          date.setTime(date.getTime() + (options.expires * 24 * 60 * 60 * 1000));\n\t      } else {\n\t          date = options.expires;\n\t      }\n\t      expires = '; expires=' + date.toUTCString(); // use expires attribute, max-age is not supported by IE\n\t    }\n\t    var path = options.path ? '; path=' + options.path : '';\n\t    var domain = options.domain ? '; domain=' + options.domain : '';\n\t    var secure = options.secure ? '; secure' : '';\n\t    document.cookie = [name, '=', encodeURIComponent(value), expires, path, domain, secure].join('');\n\t  } else { // only name given, get cookie\n\t    var cookieValue = null;\n\t    if (document.cookie && document.cookie != '') {\n\t      var cookies = document.cookie.split(';');\n\t      for (var i = 0; i < cookies.length; i++) {\n\t        var cookie = $.trim(cookies[i]);\n\t        // Does this cookie string begin with the name we want?\n\t        if (cookie.substring(0, name.length + 1) == (name + '=')) {\n\t          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\n\t          break;\n\t        }\n\t      }\n\t    }\n\t    return cookieValue;\n\t  }\n\t}\n\t\n\tfunction clickEvent(type, className, desc, options) {\n\t\n\t  var userInfo = setCookie('userInfo');\n\t\n\t  if (!userInfo) {\n\t    return false;\n\t  }\n\t\n\t  var userId;\n\t  var shopId;\n\t  var pageUrl;\n\t\n\t  try {\n\t    userId = JSON.parse(JSON.parse(userInfo)).id;\n\t    shopId = $('.j_GlobalShopid').val();\n\t    pageUrl = window.location.href;\n\t    if (!userId || !shopId || !pageUrl) {\n\t        return false;\n\t    }\n\t    userId = $.trim(userId.toString());\n\t    if (!userId.length) {\n\t        return false;\n\t    }\n\t  } catch (e) {\n\t    return false;\n\t  }\n\t\n\t  Countly.q.push(\n\t  ['add_event', {\n\t    key: type,\n\t    segmentation: {\n\t      userId: userId,\n\t      shopId: shopId,\n\t      pageUrl: pageUrl\n\t    }\n\t  }]);\n\t}\n\t\n\tmodule.exports = {\n\t  clickEvent: clickEvent\n\t} \n\n/***/ }\n/******/ ]);\n\n\n/** WEBPACK FOOTER **\n ** src/pages/pay-method/pay-method.min.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap c3339b398b9f7bca45f3\n **/","'use strict';\nvar Countly = require('components/countly/countly');\n\nvar wxpayInterFace = function (json) {\n  var onBridgeReady = function () {\n    WeixinJSBridge.invoke('getBrandWCPayRequest', {\n      'appId': json.data.appId,\n      'timeStamp': json.data.timeStamp,\n      'nonceStr': json.data.nonceStr,\n      'package': json.data.package,\n      'signType': 'MD5',\n      'paySign': json.data.paySign\n    }, function (res) {\n      var payResultForm = $('.j_WXPayResult');\n      if (res.err_msg === 'get_brand_wcpay_request:ok') {\n        payResultForm.attr('action', '/trade/paysuccess?orderNumber=' + $('.j_OrderNumber').val());\n        Countly.clickEvent('paySucceedAction');\n      } else {\n        payResultForm.attr('action', '/trade/payfailure');\n      }\n      payResultForm.submit();\n    });\n  };\n\n  if (typeof WeixinJSBridge === 'undefined') {\n    if (document.addEventListener) {\n      document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);\n    } else if (document.attachEvent) {\n      document.attachEvent('WeixinJSBridgeReady', onBridgeReady);\n      document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);\n    }\n  } else {\n    onBridgeReady();\n  }\n};\n\nZepto(function ($) {\n  //var location = window.location.href;\n  var canPay = true;\n  $('.j_WxBtn').find('input[name=\"express\"]').attr('checked', 'checked');\n\n  // 点击确认支付\n  $('.j_PaySubmit').click(function () {\n    var self = $(this);\n    if(!canPay) return;\n    canPay = false;\n    var orderNum = $('.j_OrderNumber').val();\n    $.ajax({\n      url: '/trade/itemorder/payOrderForWx',\n      type: 'POST',\n      dataType: 'json',\n      data: {\n        payMode: 10,\n        orderNumber: orderNum\n      },\n      success: function (json) {\n        self.addClass('disable');\n        if (json.isSuccess === 1) {\n          wxpayInterFace(json);\n        } else {\n          window.location = $('.j_WebTest').val();\n        }\n      },\n      error: function () { \n        canPay = true;\n      }\n    });\n  });\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/pages/pay-method/pay-method.js\n ** module id = 0\n ** module chunks = 0\n **/","\nfunction setCookie(name, value, options) {\n  if (typeof value != 'undefined') { // name and value given, set cookie\n    options = options || {};\n    if (value === null) {\n      value = '';\n      options.expires = -1;\n    }\n    var expires = '';\n    if (options.expires && (typeof options.expires == 'number' || options.expires.toUTCString)) {\n      var date;\n      if (typeof options.expires == 'number') {\n          date = new Date();\n          date.setTime(date.getTime() + (options.expires * 24 * 60 * 60 * 1000));\n      } else {\n          date = options.expires;\n      }\n      expires = '; expires=' + date.toUTCString(); // use expires attribute, max-age is not supported by IE\n    }\n    var path = options.path ? '; path=' + options.path : '';\n    var domain = options.domain ? '; domain=' + options.domain : '';\n    var secure = options.secure ? '; secure' : '';\n    document.cookie = [name, '=', encodeURIComponent(value), expires, path, domain, secure].join('');\n  } else { // only name given, get cookie\n    var cookieValue = null;\n    if (document.cookie && document.cookie != '') {\n      var cookies = document.cookie.split(';');\n      for (var i = 0; i < cookies.length; i++) {\n        var cookie = $.trim(cookies[i]);\n        // Does this cookie string begin with the name we want?\n        if (cookie.substring(0, name.length + 1) == (name + '=')) {\n          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\n          break;\n        }\n      }\n    }\n    return cookieValue;\n  }\n}\n\nfunction clickEvent(type, className, desc, options) {\n\n  var userInfo = setCookie('userInfo');\n\n  if (!userInfo) {\n    return false;\n  }\n\n  var userId;\n  var shopId;\n  var pageUrl;\n\n  try {\n    userId = JSON.parse(JSON.parse(userInfo)).id;\n    shopId = $('.j_GlobalShopid').val();\n    pageUrl = window.location.href;\n    if (!userId || !shopId || !pageUrl) {\n        return false;\n    }\n    userId = $.trim(userId.toString());\n    if (!userId.length) {\n        return false;\n    }\n  } catch (e) {\n    return false;\n  }\n\n  Countly.q.push(\n  ['add_event', {\n    key: type,\n    segmentation: {\n      userId: userId,\n      shopId: shopId,\n      pageUrl: pageUrl\n    }\n  }]);\n}\n\nmodule.exports = {\n  clickEvent: clickEvent\n} \n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/components/countly/countly.js\n ** module id = 1\n ** module chunks = 0\n **/"],"sourceRoot":""}