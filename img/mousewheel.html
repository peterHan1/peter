<!doctype html public "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="utf-8">

	<head>
		<title>img</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<style>
			.oImg{
				width:100px;
				height:100px;
				display: inline-block;
				margin-right:10px;
			}
			.oImg img{
				width:100%;
				height:100%;
			}
			.dragAble {
				position: relative;
				cursor: move;
			}
			.img-con {
				position: relative;
				width: 713px;
				height: 455px;
				overflow: hidden;
				border: 1px solid red;
			}
			.box{ 
		        position: absolute;
		        left:0;
		        top:0;
		        right:0;
		        bottom:0;
			}
			.imgBox{
				display: inline-block;
				position:fixed;
				width:600px;
			    	height: 600px;
			    	z-index: 999;
			    	left: 50%;
		        top: 50%;
		        -webkit-transform: translateX(-50%) translateY(-50%);
		        -moz-transform: translateX(-50%) translateY(-50%);
		        -ms-transform: translateX(-50%) translateY(-50%);
		        -o-transform: translateX(-50%) translateY(-50%);
		        transform: translateX(-50%) translateY(-50%);   
			}
			.imgBox .imgs{
				position: absolute;
				left: 0;
				top: 0;
				right: 0;
				bottom: 0;
				width: 600px;
				height: 600px;
		        background-color:#fff;
		        overflow: hidden;
			}
			.imgBox img{
				width:100%;
				height:100%;
				position:relative;
				cursor:move;
				transform: all 0.7s ease-out;
			}
			.imgBox .rotate{
				position: absolute;
				text-align: center;
				left:0;
				right:0;
				bottom:0;
				z-index: 999;
			}
			.imgBox .rotate img{
				display: inline-block;
				width:30px;
				height:30px;
				cursor: pointer;
				position: relative;
				overflow: hidden;
				margin-left:10px;
			}
			.box .shade{
		    	position:fixed;  
		        left: 0;
		        top: 0;
		        right: 0;
		        bottom: 0;
		        background-color:#000;
		        -moz-opacity: 0.5;
				opacity:0.5;
				z-index:99;
				filter: alpha(opacity=50);
		    }
		</style>
	</head>
	<body>
		<div class="oImg">
			<img src="car1.jpg"/>
		</div>
		<div class="oImg">
			<img src="car2.jpg"/>
		</div>
		<div class="oImg">
			<img src="car3.jpg"/>
		</div>
		<div class="oImg">
			<img src="car4.jpg"/>
		</div>
		<div class="oImg">
			<img src="car5.jpg"/>
		</div>
		<!--<p class="img-con"><img src="car.jpg" class="dragAble" /></p>-->
	</body>
<script src="js/jquery-2.1.0.min.js" type="text/javascript"></script>  
	<script language="javascript">
			window.onload = function() {
				var imgs = $('img');
               for (var i = 0; i < imgs.length; ++i) {  
                   imgs[i].onclick = function () {  
						bigImg($(this).attr("src"))
                   }  
               	}
			}
			function bigImg(src){
				var imgBox = "<div class='box'><div class='imgBox'><div class='imgs'><img src="+ src +" class='big_img'></div><div class='rotate'><img src='rotateLeft.png' title='向左旋转' onclick='rotateLeft(this)'><img src='rotateRight.png' title='向右旋转' onclick='rotateLeft(this)'><img src='zoomUp.png' title='放大' onclick='zoomUp(this)'><img src='zoomOut.png' title='缩小' onclick='zoomOut(this)'></div></div><div class='shade' onclick='closeBigimg()'></div></div>"
				$("body").append(imgBox)
				$("body").css({  
					"overflow-y": "hidden"  
				});  
				bigImgFn()
			}
			function closeBigimg(){
				$(".box").remove();
				$("body").css({  
					"overflow-y": "auto"  
				});
			}
			var current = 0;
			function rotateLeft(e){
				var oImg = e.parentNode.parentNode.getElementsByTagName("img")[0];
				current = (current+90)%360;
				oImg.style.transform = 'rotate('+current+'deg)';
			}
			function rotateRight(e){
				var oImg = e.parentNode.parentNode.getElementsByTagName("img")[0];
				current = (current-90)%360;
				oImg.style.transform = 'rotate('+current+'deg)';
			}
			function zoomUp(e){
				var oImg = e.parentNode.parentNode.getElementsByTagName("img")[0];
				var oImgW = oImg.offsetWidth;
				var oImgH = oImg.offsetHeight;
				var oImgL = oImg.offsetLeft;
				var oImgT = oImg.offsetTop;
				oImg.style.width = oImgW * 1.1 + "px";
				oImg.style.height = oImgH * 1.1 + "px";
				var NImgW = oImg.offsetWidth;
				var NImgH = oImg.offsetHeight;
				oImg.style.left = oImgL + ((NImgW - oImgW)/2) * -1 + "px";
				oImg.style.top = oImgT + ((NImgH - oImgH)/2) * -1 + "px";

			}
			function zoomOut(e){
				var oImg = e.parentNode.parentNode.getElementsByTagName("img")[0];
				var oImgW = oImg.offsetWidth;
				var oImgH = oImg.offsetHeight;
				var oImgL = oImg.offsetLeft;
				var oImgT = oImg.offsetTop;
				if(oImgW < 600){
					return false;
				}else{
					oImg.style.width = oImgW * 0.9 + "px";
					oImg.style.height = oImgH * 0.9 + "px";
					var NImgW = oImg.offsetWidth;
					var NImgH = oImg.offsetHeight;
					if(oImgL < 0){
						oImg.style.left = oImgL + ((NImgW - oImgW)/2) * -1 + "px";
					}else{
						oImg.style.left = 0 + "px";
					}
					if(oImgT < 0){
						oImg.style.top = oImgT + ((NImgH - oImgH)/2) * -1 + "px";
					}else{
						oImg.style.top = 0 + "px";
					}
				}
			}
		
		//放大缩小  
		function bigImgFn() {
			var box = document.getElementsByClassName("box")[0]
			var oImg = box.getElementsByTagName("img")[0];
			function fnWheel(obj, fncc) {
				obj.onmousewheel = fn;
				if(obj.addEventListener) {
					obj.addEventListener('DOMMouseScroll', fn, false);
				}

				function fn(ev) {
					var oEvent = ev || window.event;
					var down = true;

					if(oEvent.detail) {
						down = oEvent.detail > 0
					} else {
						down = oEvent.wheelDelta < 0
					}
					if(fncc) {
						fncc.call(this, down, oEvent);
					}
					if(oEvent.preventDefault) {
						oEvent.preventDefault();
					}
					return false;
				}

			};
			fnWheel(oImg, function(down, oEvent) {

				var oldWidth = this.offsetWidth;
				var oldHeight = this.offsetHeight;
				
				if(down) {
					if(this.offsetWidth <= 610) {
						return false;
					}else{
						var oldLeft = this.offsetLeft + 10;
						var oldTop = this.offsetTop + 10;
						this.style.width = this.offsetWidth * 0.9 + "px";
						this.style.height = this.offsetHeight * 0.9 + "px";
					}
				} else {
					var oldLeft = this.offsetLeft - 10;
					var oldTop = this.offsetTop - 10;
					this.style.width = this.offsetWidth * 1.1 + "px";
					this.style.height = this.offsetHeight * 1.1 + "px";
				}

				var scaleX = (oEvent.clientX - oldLeft) / oldWidth;
				var scaleY = (oEvent.clientY - oldTop) / oldHeight;
				var newWidth = this.offsetWidth;
				var newHeight = this.offsetHeight;
				this.style.left = oldLeft - scaleX * ((newWidth - oldWidth) / 2) + "px";
				this.style.top = oldTop - scaleY * ((newHeight - oldHeight) / 2) + "px";
			});
		}
		//拖拽  
		var ie = document.all;
		var nn6 = document.getElementByIdx && !document.all;
		var isdrag = false;
		var y, x;
		var oDragObj;
		function moveMouse(e) {
			if(isdrag) {
				var boxWidth = $(".imgBox").width();
				var boxHei = $(".imgBox").height();
				var boxLeft = $(".imgBox").offset().left;
				var boxTop = $(".imgBox").offset().top;
				console.log(e.clientY - boxTop)
				if(e.clientX - boxLeft <= 0 || e.clientX >= boxLeft + boxWidth || e.clientY - boxTop <= 0 || e.clientY >= boxTop + boxHei){
					return false;
				}
				oDragObj.style.top = (nTY + e.clientY - y) + "px";
				oDragObj.style.left = (nTX + e.clientX - x) + "px";
				return false;
			}
		}
		function initDrag(e) {
			var oDragHandle = e.target
			var topElement = "HTML";
			while(oDragHandle.tagName != topElement && oDragHandle.className != "big_img") {
				oDragHandle = nn6 ? oDragHandle.parentNode : oDragHandle.parentElement;
			}
			if(oDragHandle.className == "big_img") {
				isdrag = true;
				oDragObj = oDragHandle;
				nTY = parseInt(oDragObj.style.top + 0);
				y = e.clientY
				nTX = parseInt(oDragObj.style.left + 0);
				x = e.clientX;
				document.onmousemove = moveMouse;
				return false;
			}
		}
		document.onmousedown = initDrag;
		document.onmouseup = new Function("isdrag=false");
	</script>

</html>