$(function(){
	var code = '123';// 图形验证码的初始值
	var isSuccess = 1;// 短信验证码是否成功发送 1:发送成功 0：失败
	var message = '短信验证码';// 短信验证码内容，赋值的话，只需要更改message = '456';的，message = '短信验证码';不需要更改

	// 密码可见性转换
	$('.iconHide').on('click',function(){
		$('.show').find('input').val($(this).siblings().val());
		$(this).parent().hide();
		$('.show').show();
		$('.pswShow').focus();
	})
	$('.iconShow').on('click',function(){
		$('.hide').find('input').val($(this).siblings().val());
		if ($(this).siblings().val() != '') {
			$('.pswHide').css({'color':'#000','font-size':'0.4rem'});
		} else {
			$('.pswHide').css('font-size','0.28rem');
		}
		$(this).parent().hide();
		$('.hide').show();
		$('.pswHide').focus();
	})

	// 点击获取短信验证码，并验证图形验证码是否正确
	var num = 60;// 倒计时
	var timer = '';
	$('.code').on('click',function(){
		if (num != 60) {
			return false;
		}
		clearInterval(timer);
		if ($('.checkIpt').val() == code) {
			// 开始发送手机短信验证码
			if (isSuccess == 1) {
				layer.msg('验证码已发送到您的手机');
				message = '456';// 短信验证码的内容
				timer = setInterval(function() {
					$('.code').css({'color':'#626262','font-size':'0.28rem'});
					num--;
					$('.code').html(num+'S');
					if (num < 0) {
						clearInterval(timer);
						num = 60;
						message = '短信验证码';// 60秒时间完结后返回短信验证码的初始值,需要重新点击获取新值
						$('.code').html('重新获取验证码');
						$('.code').css({'color':'#ff7400','font-size':'0.24rem'});
					}
				}, 1000);
			} else {
				layer.msg('验证码发送失败，请重新获取');
			}
		} else if ($('.checkIpt').val() == ''){
			layer.msg('请输入图片验证码');
		} else {
			layer.msg('图片验证码错误，请重新输入');
			code = '234'; // 更新图形验证码
		}
	})
	// 图形验证码，验证
	$('.checkIpt').on('input',function(){
		if ($(this).val() == code && $('.codeIpt').val() == message && /^[0-9]*$/g.test($('.codeIpt').val()) && /^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,16}$/g.test($('.pswHide').val())) {
			$('.next').css('background','#ff7400');
			// 请求成功
		} else {
			$('.next').css('background','#cacaca');
		}
	})
	// 短信验证码，验证
	$('.codeIpt').on('input',function(){
		if ($(this).val().length > 8) {
			$(this).val($(this).val().substring(0,8));
		}
		if ($(this).val() == message && /^[0-9]*$/g.test($(this).val()) && $('.checkIpt').val() == code && /^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,16}$/g.test($('.pswHide').val())) {
			$('.next').css('background','#ff7400');
			// 请求成功
		} else {
			$('.next').css('background','#cacaca');
		}
	})
	// 登录密码验证
	$('.pswIpt').on('input',function(){
		$('.pswHide').val($(this).val());
		$('.pswShow').val($(this).val());
		if((/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,16}$/g.test($(this).val())) && $('.checkIpt').val() == code && $('.codeIpt').val() == message){
			$('.next').css('background','#ff7400');
		} else {
			$('.next').css('background','#cacaca');
		}
	})
	$('.pswIpt').on('keyup',function(){
		$(this).val($(this).val().replace(/[^\w]/g, ""));
	})
	// 完成按钮验证
	$('.next').on('click',function(){
		if ($('.checkIpt').val() == code) {
			if ($('.codeIpt').val() == message) {
				if (/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,16}$/g.test($('.pswHide').val())) {
					// 提交成功
					layer.msg('注册成功');
					setTimeout(function(){
						window.location.href = './openDeposit.html';// 进入激活存管页面
					},2000);
				} else {
					layer.msg('请设置6-16位的登录密码');
					return false;
				}
			} else {
				layer.msg('请输入正确的短信验证码');
				return false;
			}
		} else {
			layer.msg('请输入正确的图形验证码');
			return false;
		}
	})
})
