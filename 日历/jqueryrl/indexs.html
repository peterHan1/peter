<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0,user-scalable=no" name="viewport">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>
    <script src="js/jquery-1.8.3.min.js"></script>
    <link rel="stylesheet" href="css/index.css">
</head>

<body>
	<div class="datas_inp">
		<input class="ipt_date" name="dotime1" id="dotime1" value="" placeholder="请选择时间" readonly="readonly"/>
	</div>
    <!-- 账户主要表格 -->
    <div class="account_box dis_none">
        <div class="account_title">
        	<div class="data_top">
            	<div class="data_top_btn data_top_btn_l fl">&lt;</div>
            	<div class="fl data_top_datas">
            		<span class="f_year"></span>年<span class="f_month"></span>月
            	</div>
            	<div class="data_top_btn data_top_btn_r fr">&gt;</div>
        	</div>
        </div>
        <div class="data_table">
            <div class="celarfix">
                <div class="data_table_th">日</div>
                <div class="data_table_th">一</div>
                <div class="data_table_th">二</div>
                <div class="data_table_th">三</div>
                <div class="data_table_th">四</div>
                <div class="data_table_th">五</div>
                <div class="data_table_th">六</div>
                <div class="clear"></div>
            </div>
            <div class="data_tbody clearfix">

            </div>
        </div>
    </div>
</body>
<script>
$(function(){
	$(".ipt_date").on("click",function(){
		$(".account_box").toggle();
		datas($(this))
	})
	function datas(inpval){
	    var dats = '<div class="account_box"><div class="account_title"><div class="data_top"><div class="data_top_btn data_top_btn_l fl">&lt;</div><div class="fl data_top_datas"><span class="f_year"></span>年<span class="f_month"></span>月</div><div class="data_top_btn data_top_btn_r fr">&gt;</div></div></div><div class="data_table"><div class="celarfix"><div class="data_table_th">日</div><div class="data_table_th">一</div><div class="data_table_th">二</div><div class="data_table_th">三</div><div class="data_table_th">四</div><div class="data_table_th">五</div><div class="data_table_th">六</div><div class="clear"></div></div><div class="data_tbody clearfix"></div></div></div>'
		c = {};
   		c.view = function() {
   			console.log(666)
   		}();
		
	    //页面加载初始化年月
	    var mydate = new Date();
	    $(".f_year").html( mydate.getFullYear() );
	    $(".f_month").html( mydate.getMonth()+1 );
	    showDate(mydate.getFullYear(),mydate.getMonth()+1);
	    var str = showDate(mydate.getFullYear(),mydate.getMonth()+1);
	    //日历上一月
	    $(".data_top_btn_l ").click(function(){
	        var mm = parseInt($(".f_month").html());
	        var yy = parseInt($(".f_year").html());
	        if( mm == 1){//返回12月
	            $(".f_year").html(yy-1);
	            $(".f_month").html(12);
	            showDate(yy-1,12);
	        }else{//上一月
	            $(".f_month").html(mm-1);
	            showDate(yy,mm-1);
	        }
	    })
	    //日历下一月
	    $(".data_top_btn_r").click(function(){
	        var mm = parseInt($(".f_month").html());
	        var yy = parseInt($(".f_year").html());
	        if( mm == 12){//返回12月
	            $(".f_year").html(yy+1);
	            $(".f_month").html(1);
	            showDate(yy+1,1);
	        }else{//上一月
	            $(".f_month").html(mm+1);
	            showDate(yy,mm+1);
	        }
	    })
	    //返回本月
	  /*  $(".data_btn_mon").click(function(){
	        $(".f_year").html( mydate.getFullYear() );
	        $(".f_month").html( mydate.getMonth()+1 );
	        showDate(mydate.getFullYear(),mydate.getMonth()+1);
	    })*/
	    
	    //读取年月写入日历  重点算法!!!!!!!!!!!
	    function showDate(yyyy,mm){
	    	var mydate = new Date();
	        var y = mydate.getFullYear()
	        var m = mydate.getMonth()+1;
	        var dd = new Date(parseInt(yyyy),parseInt(mm), 0);   //Wed Mar 31 00:00:00 UTC+0800 2010  
	        var daysCount = dd.getDate();            //本月天数  
	        var mystr ="";//写入代码
	        var icon = "";//图标代码
	        var today = new Date().getDate(); //今天几号  21
	        var monthstart = new Date(parseInt(yyyy)+"/"+parseInt(mm)+"/1").getDay()//本月1日周几  
	        var lastMonth; //上一月天数
	        var nextMounth//下一月天数
	        if(  parseInt(mm) ==1 ){
	            lastMonth = new Date(parseInt(yyyy)-1,parseInt(12), 0).getDate();
	        }else{
	            lastMonth = new Date(parseInt(yyyy),parseInt(mm)-1, 0).getDate();
	        }
	        if( parseInt(mm) ==12 ){
	            nextMounth = new Date(parseInt(yyyy)+1,parseInt(1), 0).getDate();
	        }else{
	            nextMounth = new Date(parseInt(yyyy),parseInt(mm)+1, 0).getDate();
	        }
	        //计算上月空格数
	        for(j=monthstart;j>0;j--){
	            mystr += "<div class='data_table_td data_null data_lastMonth' style='color:#ccc;'>"+(lastMonth-j+1)+"</div>";
	        }
	        
	        //本月单元格
	         for(i=0;i<daysCount;i++){
	             //这里为一个单元格，添加内容在此
	            mystr += "<div class='data_table_td data_number'><span class='data_day'>"+(i+1)+"</span></div>"; 
	        }
	        /*for(i=0;i<daysCount;i++){
	            mystr += "<div class='data_table_td data_number'><span class='data_day'>"+(i+1)+"</span>"
	                    +"<div class='data_money'></div>"
	                    +"<div class='data_table_msg'>回款中<span class='major'>1</span>笔。回款本息;<span class='major'>1，000，000</span>元</div>"
	                    +"</div>"; 
	        }*/
	        
	        //计算下月空格数
	        for(k=0; k<42-(daysCount+monthstart);k++ ){//表格保持等高6行42个单元格
	            mystr += "<div class='data_table_td data_null data_nextMounth' style='color:#ccc;'>"+(k+1)+"</div>";
	        }
	         
	        
	        
	        //写入日历
	        $(".data_table .data_tbody").html(mystr);
	        //给今日加class
	        if( mydate.getFullYear() == yyyy){
	            if( (mydate.getMonth()+1 ) == mm){
	                var today = mydate.getDate();
	                var lastNum = $(".data_lastMonth").length;
	                $(".data_table .data_table_td").eq(today+lastNum-1).addClass("f_today");
	            }
	        }
	        //绑定选择方法
	        $(".data_table .data_number").off("click");
	        $(".data_table .data_number").on("click",function(){
	        	var d = $(this).children().html();
	        	var k = y +'-'+ m +'-'+d;
	        	inpval.val(y +'-'+ m +'-'+d);
	            $(this).addClass("datas_on");
	            $(".account_box ").fadeOut();
	        });
	        
	        //绑定查看方法
	        $(".data_money").off("mouseover");
	        $(".data_money").on("mouseover",function(){
	            $(this).parent().find(".data_table_msg").show();
	        });
	        $(".data_table_msg").off("mouseover");
	        $(".data_table_msg").on("mouseover",function(){
	            $(this).show();
	        });
	        $(".data_money").off("mouseleave");
	        $(".data_money").on("mouseleave",function(){
	            $(this).parent().find(".data_table_msg").hide();
	        });
	        $(".data_table_msg").off("mouseleave");
	        $(".data_table_msg").on("mouseleave",function(){
	            $(this).hide();
	        });
	    }
    };
})
</script>
</html>